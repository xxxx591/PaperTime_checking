/**
 * Created by pangliang on 2017/7/4.
 */
    //加载所有的layer.use()
    var form = layui.form()
        ,layer = layui.layer
        , $ =layui.jquery;
    // $(".yhq-d1").click(function () {
    //     layer.open({
    //         title:'填写推荐人',
    //         type:1,
    //         area: ['800px', '390px'],
    //         content:'<div class="box-layer box-layer-tjtk"><h3>活动内容：</h3><p>填写推荐人的手机号码，推荐人和被推荐人都获得10积分检测权。</p><br/><h3>活动规则：</h3><p>每个用户作为被推荐人限参加一次，作为推荐人可以多次，<br/>获得字数可以累计，推荐人必须在被推荐人之前注册成为papertime的用户。</p><br/><div class="layui-input-inline"><input type="text" class="layui-input" placeholder="请输入推荐人号码"></div><div class="layui-input-inline"><a href="" class="layui-btn layui-btn-dh">兑换</a></div><p><strong>您已参加过此活动，不能重复参加！</strong></p><div class="record record-wcj"></div> </div>',
    //         success: function(layero, index){
    //             $('.btn-x').click( function(){   layer.close(index)  } )
    //         }
    //     })
    // });
    $(".yhq-add").click(function () {
        layer.open({
            title:false,
            type:1,
            closeBtn: 0,
            scrollbar: false,
            area: ['600px', '500px'],
            content:'<div class="box-layer box-layer-mytk"><img src="/resources/images/hdts.jpg" alt="" title=""><div class="btn-x"></div></div>',
            success: function(layero, index){
                $('.btn-x').click( function(){   layer.close(index)  } )
            }
        })
    });

function showActivityDetail(id) {
    var index = loading();
    $.ajax({
        url: '/coupon/activityDetails.html?id='+id,
        type: 'GET',
        cache: false,
        success: function (detailContent) {
            layer.close(index);
            layer.open({
                type: 1,
                title: false,
                fix: false,
                closeBtn: 1,
                shadeClose: true,
                area: 'auto',
                content: detailContent
            });
        },
        error:function (e) {
            if(e.status=='403'){
                window.location.href="/webUser/login.html";
            }
            layer.close(index);
        }
    });
}
$(".mfjf-x").click(function () {
    layer.closeAll();
});

function selectShareImg(inputObj) {
    var pos = -1;
    var filePath = inputObj.value;
    if (filePath.indexOf("/") > -1) {
        pos = filePath.lastIndexOf("/") * 1;
    } else if (filePath.indexOf("\\") > -1) {
        pos = filePath.lastIndexOf("\\") * 1;
    }
    var fileName = filePath.substring(pos + 1);
    var fileExtension = fileName.toLowerCase().substr(fileName.lastIndexOf('.'));
    if (/.bmp|.jpg|.gif|.png/.test(fileExtension)) {
        $('.mfjf-ts').html('');
        $('#imageShare').val(fileName);
    } else {
        $('.mfjf-ts').html('只支持bmp、jpg、gif或png格式的图片');
        inputObj.value = "";
        $('#imageShare').val("");
    }
}

function submitQQShareImg(id) {
    if ($("#fileUploadQQShareImg").val() == '') {
        $('.mfjf-ts').html('请选择上传文件!');
        return false;
    }
    $.ajaxFileUpload({
        url: '/coupon/submitQQShareImg.html',
        type: 'POST',
        secureuri: false,
        fileElementId: 'fileUploadQQShareImg',
        dataType: 'json',
        data:{actId:id},
        success: function (json) {
            if (json.state) {
                $('.mfjf-ts').html('提交成功,申请通过后优惠券会自动发送到账户中!').show();
            } else {
                $('.mfjf-ts').html(json.message);
            }
            $('#imageShare').val("");
        },
        error: function (e) {
            if (e.status == 403) {
                location.reload();
            }
            $('.mfjf-ts').html('提交分享图片失败，请重试！').show();
        }
    });
}

