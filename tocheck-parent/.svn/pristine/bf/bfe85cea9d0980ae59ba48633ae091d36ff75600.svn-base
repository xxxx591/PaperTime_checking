package com.tocheck.parent.web.ctrl;

import com.alibaba.fastjson.JSON;
import com.github.pagehelper.PageInfo;
import com.tocheck.parent.common.util.SSDBUtils;
import com.tocheck.parent.core.entity.SystemTopic;
import com.tocheck.parent.core.service.SystemTopicService;
import org.apache.commons.lang3.StringUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;

/**
 * @author pangliang
 * @create 2017-06-06 10:56
 **/
@Controller
public class NewsCtrl {

    @Autowired
    private SystemTopicService systemTopicService;
    @Autowired
    private SSDBUtils ssdbUtils;

    @RequestMapping(value = "/news", method = RequestMethod.GET)
    public String news(Integer p, Model model) {
        p = p == null ? 1 : p;
        PageInfo<SystemTopic> page;
        String news = ssdbUtils.getValue("news-"+p);
        if (StringUtils.isNoneBlank(news)) {
            page = JSON.parseObject(news, PageInfo.class);
        } else {
            page = systemTopicService.listPage(p);
            ssdbUtils.save("news-"+p,JSON.toJSONString(page));
        }
        model.addAttribute("page", page);
        return "news";
    }

    @RequestMapping(value = "/newDetail/{id:[0-9]+}", method = RequestMethod.GET)
    public String newDetail(@PathVariable long id, Model model) {
        SystemTopic topic = systemTopicService.getById(id);
        model.addAttribute("topic", topic);
        return "newDetail";
    }
}
