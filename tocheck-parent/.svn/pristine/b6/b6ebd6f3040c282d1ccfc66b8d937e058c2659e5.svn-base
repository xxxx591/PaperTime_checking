package com.tocheck.parent.web.ctrl;

import com.github.pagehelper.PageInfo;
import com.tocheck.parent.core.entity.SystemTopic;
import com.tocheck.parent.core.service.SystemTopicService;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;

/**
 * @author pangliang
 * @create 2017-06-06 10:56
 **/
@Controller
public class NewsCtrl {

    @Autowired
    private SystemTopicService systemTopicService;

    private Logger  logger = LoggerFactory.getLogger(NewsCtrl.class);

    @RequestMapping(value = "/news", method = RequestMethod.GET)
    public String news(Integer p, Model model) {
        try {
            p = p == null ? 1 : p;
            PageInfo<SystemTopic> page = systemTopicService.listPage(p);
            model.addAttribute("page", page);
            return "news";
        }catch (Exception e){
            logger.error("进入新闻资讯页面失败!",e);
        }
        return "redirect:/500.html";
    }

    @RequestMapping(value = "/newDetail/{id:[0-9]+}", method = RequestMethod.GET)
    public String newDetail(@PathVariable long id, Model model) {
        try {
            SystemTopic topic = systemTopicService.getById(id);
            model.addAttribute("topic", topic);

            SystemTopic next = systemTopicService.nextArticle(id);
            SystemTopic prev = systemTopicService.prevArticle(id);
            model.addAttribute("next",next);
            model.addAttribute("prev",prev);
        }catch (Exception e){
          e.printStackTrace();
          logger.error("进入新闻详情页失败!",e);
        }
        return "newDetail";
    }
}
