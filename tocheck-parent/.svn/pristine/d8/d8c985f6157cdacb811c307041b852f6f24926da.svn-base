/**
 * Created by pangliang on 2017/7/4.
 */
    //加载所有的layer.use()
    var form = layui.form()
        ,layer = layui.layer
        , $ =layui.jquery;
    $(".yhq-add").click(function () {
        layer.open({
            title:false,
            type:1,
            closeBtn: 0,
            scrollbar: false,
            area: ['600px', '500px'],
            content:'<div class="box-layer box-layer-mytk"><img src="/resources/images/hdts.jpg" alt="" title=""><div class="btn-x"></div></div>',
            success: function(layero, index){
                $('.btn-x').click( function(){   layer.close(index)  } )
            }
        })
    });

function showActivityDetail(id) {
    var index = loading();
    $.ajax({
        url: '/coupon/activityDetails.html?id='+id,
        type: 'GET',
        cache: false,
        success: function (detailContent) {
            layer.close(index);
            layer.open({
                type: 1,
                title: false,
                fix: false,
                closeBtn: 1,
                shadeClose: true,
                area: 'auto',
                content: detailContent
            });
        },
        error:function (e) {
            if(e.status=='403'){
                window.location.href="/webUser/login.html";
            }
            layer.close(index);
        }
    });
}
$(".mfjf-x").click(function () {
    layer.closeAll();
});

function selectShareImg(inputObj) {
    var pos = -1;
    var filePath = inputObj.value;
    if (filePath.indexOf("/") > -1) {
        pos = filePath.lastIndexOf("/") * 1;
    } else if (filePath.indexOf("\\") > -1) {
        pos = filePath.lastIndexOf("\\") * 1;
    }
    var fileName = filePath.substring(pos + 1);
    var fileExtension = fileName.toLowerCase().substr(fileName.lastIndexOf('.'));
    if (/.bmp|.jpg|.gif|.png/.test(fileExtension)) {
        $('.mfjf-ts').html('');
        $('#imageShare').val(fileName);
    } else {
        $('.mfjf-ts').html('只支持bmp、jpg、gif或png格式的图片');
        inputObj.value = "";
        $('#imageShare').val("");
    }
}

function submitQQShareImg(id) {
    if ($("#fileUploadQQShareImg").val() == '') {
        $('.mfjf-ts').html('请选择上传文件!');
        return false;
    }
    var index= loading();
    $.ajaxFileUpload({
        url: '/coupon/submitQQShareImg.html',
        type: 'POST',
        secureuri: false,
        fileElementId: 'fileUploadQQShareImg',
        dataType: 'json',
        data:{actId:id},
        success: function (json) {
            layer.close(index);
            if (json.state) {
                $('.mfjf-ts').html('提交成功,申请通过后优惠券会自动发送到账户中!').show();
            } else {
                $('.mfjf-ts').html(json.message);
            }
            $('#imageShare').val("");
        },
        error: function (e) {
            layer.close(index);
            if (e.status == 403) {
                location.reload();
            }
            $('.mfjf-ts').html('提交分享图片失败，请重试！').show();
        }
    });

}

